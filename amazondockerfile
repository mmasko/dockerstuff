FROM amazonlinux:latest

RUN yum update -y && \
amazon-linux-extras enable java-openjdk11 python3.8 ansible2

RUN yum install -y java-11-openjdk git python38 ansible openssh-server && \
yum clean metadata 

RUN useradd ansible
RUN sed -i 's/PermitRootLogin without-password/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN git clone https://github.com/mmasko/dockerstuff.git && \
ansible-playbook dockerstuff/ansiblesetup.yml -vvvv

EXPOSE 22
CMD ["/usr/sbin/sshd", "-D"]

USER ansible
RUN ansible --version
# USER ec2-user
# RUN yum install -y python-pip && \
# pip install --user --upgrade ansible
